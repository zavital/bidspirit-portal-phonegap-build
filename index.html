
<!DOCTYPE html>
   

<html>
	<style>
		
		div{ margin:30px;}
		
	</style>

	<head>
		<meta name="viewport" content="width=device-width">
		<meta name="fragment" content="!">
		<meta charset="utf-8">		
		<title >Bidspirit - auction houses in Israel</title>
		<meta name="description" content="The Bidspirit portal is your gate to the auction housesâ€™ arena in Israel trading in art, collectibles, jewelry, antiques, stamps, coins, old books, judaica, and more" /> 
		
		<!-- 
		<link rel="stylesheet" href="http://54.210.154.63:8080/c.css" />
		<link rel="stylesheet" href="t.css" />
 		      -->  
 
		 <script src="phonegap.js"></script>
		 
		 
		
</head>	
	
	<body>	 
	 
		
		
		<div>Version:1</div>
				
		<div id="jsp">(jsp)</div>
		
		<div id="localScript">(localscript)</div>
		
		<div id="remoteScript">(remotescript)</div>
		
		<div id="dynamicScript">(dynamicScript)</div>
		
		
		
		
		<script>
			document.getElementById("jsp").innerHTML="jsp";
			
			function loadjscssfile(filename, filetype){
			    if (filetype=="js"){ //if filename is a external JavaScript file
			        var fileref=document.createElement('script')
			        fileref.setAttribute("type","text/javascript")
			        fileref.setAttribute("src", filename)
			    }
			    else if (filetype=="css"){ //if filename is an external CSS file
			        var fileref=document.createElement("link")
			        fileref.setAttribute("rel", "stylesheet")
			        fileref.setAttribute("type", "text/css")
			        fileref.setAttribute("href", filename)
			    }
			    if (typeof fileref!="undefined")
			        document.getElementsByTagName("head")[0].appendChild(fileref)
			}
			
			loadjscssfile("http://54.210.154.63:8080/z.js","js");
			loadjscssfile("./test.js","js");
			loadjscssfile("http://54.210.154.63:8080/c.css","css");
			loadjscssfile("./t.css","css");
			
		</script>
<!-- 
		<script src="http://54.210.154.63:8080/z.js"> </script>
		
		<script src="./test.js">		 </script>
		
		 -->
		
				
		<img 
			style="margin:20px auto;display:block;" 
			src="pagePreLoader.gif" 
			id="pagePreLoader"
		>
		
		<form onsubmit="return saveText()">
            <label for="name">Name</label><br>
            <input id="name" /><br>

            <label for="desc">Description</label><br>
            <input id="desc" /><br>

            <input type="submit" value="Save" />
        </form>


        <dl id="definitions">

        </dl>
        
        <div onClick="loadJs()">Load js</div>
        
        <div onClick="saveJs()">wtite js</div>
        
        <div onClick="runJs()">Run js</div>
		
		
		
    <script>
    	var jsFile = 'test.js';
    	
        var FILENAME = 'database.db',
            $ = function (id) {
                return document.getElementById(id);
            },
            failCB = function (msg) {
                return function () {
                    alert('[FAIL] ' + msg);
                }
            },
            file = {
                writer: { available: false },
                reader: { available: false }
            },
            dbEntries = [];
            
        document.addEventListener('deviceready', function () {
            var fail = failCB('requestFileSystem');
            window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
        }, false);
        
        function gotFS(fs) {
            var fail = failCB('getFile');
            fs.root.getFile(FILENAME, {create: true, exclusive: false},
                            gotFileEntry, fail);
        }
        function gotFileEntry(fileEntry) {
            var fail = failCB('createWriter');
            file.entry = fileEntry;
            fileEntry.createWriter(gotFileWriter, fail);
            readText();
        }
        function gotFileWriter(fileWriter) {
            file.writer.available = true;
            file.writer.object = fileWriter;
        }
        function saveText(e) {
            var name = $('name').value,
                desc = $('desc').value,
                fail;
            dbEntries.push('<dt>' + name + '</dt><dd>' + desc + '</dd>')
            $('name').value = '';
            $('desc').value = '';
            $('definitions').innerHTML = dbEntries.join('');
            if (file.writer.available) {
                file.writer.available = false;
                file.writer.object.onwriteend = function (evt) {
                    file.writer.available = true;
                    file.writer.object.seek(0);
                }
                file.writer.object.write(dbEntries.join("\n"));
            }
            return false;
        }
        function readText() {
            if (file.entry) {
                file.entry.file(function (dbFile) {
                    var reader = new FileReader();
                    reader.onloadend = function (evt) {
                        var textArray = evt.target.result.split("\n");
                        dbEntries = textArray.concat(dbEntries);
                        $('definitions').innerHTML = dbEntries.join('');
                    }
                    reader.readAsText(dbFile);
                }, failCB("FileReader"));
            }
            return false;
        }
        
        function saveJs() {
        	var d = 1;
        	var fail = function(){alert("failed "+d);}
        	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fs){
        		d++;        		
        		fs.root.getFile("z.js", {create: true, exclusive: false}, function(fileEntry){
        			d++;
        			alert("got file entry");
        			fileEntry.createWriter(function(fileWriter){
        				alert("got writer");
        				fileWriter.onwriteend = function (evt) {
        					alert("write end");
        					fileWriter.seek(0);
                        }
        				fileWriter.write('document.getElementById("dynamicScript").innerHTML="dynamicScript";');
        			}, fail);
        		},fail);
        	},fail);
        				
        }
        
        function loadJs(){
        	var d = 1;
        	var fail = function(){alert("failed "+d);}
        	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fs){
        		d++;        		
        		fs.root.getFile("z.js", {create: true, exclusive: false}, function(fileEntry){
        			d++;
        			alert("got file entry");
        			fileEntry.file(function(file){
        				alert("got file");
        				var reader = new FileReader();
        				reader.onloadend = function (evt) {
        					alert("loaded");
        					alert(evt.target.result);
        					injectScript(evt.target.result);
        				}
        				reader.readAsText(file);
        			});
        		}, fail);
        	}, fail);
        }
        
        function injectScript(text) {
            var script = document.createElement("script"),
                head = document.head || document.getElementsByTagName("head")[0];
            script.appendChild(document.createTextNode(text));
            head.insertBefore(script, head.firstChild);
        }
        
        function runJs(){
        	loadjscssfile("//localhost/persistent/z.js","js");
        }
    </script>
		
		
	</body>
</Html>

			
	  	